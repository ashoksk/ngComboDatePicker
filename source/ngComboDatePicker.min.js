/*
 * ngComboDatePicker v1.1.1
 * http://github.com/jfmdev/ngComboDatePicker
 * «Copyright 2015 Jose F. Maldonado»
 * License: LGPLv3 (http://www.gnu.org/licenses/lgpl-3.0.html)
 */
angular.module("ngComboDatePicker",[]).directive("ngComboDatePicker",function(){return{restrict:"AEC",scope:{ngModel:"=",ngDate:"@",ngMinDate:"@",ngMaxDate:"@",ngMonths:"@",ngOrder:"@",ngAttrsDate:"@",ngAttrsMonth:"@",ngAttrsYear:"@",ngYearOrder:"@"},controller:["$scope",function(e){function n(e){var n=null;return void 0!==e&&null!==e&&(e instanceof Date?n=e:("number"==typeof e||"string"==typeof e)&&(n=new Date(isNaN(e)?e:parseInt(e,10)))),n}function t(e,n){var t=31;return null!=e&&((4==e||6==e||9==e||11==e)&&(t=30),null!=n&&2==e&&(t=n%4==0&&n%100!=0?29:28)),t}function a(e){var n=null;if(null!=e){try{n=JSON.parse(e)}catch(t){}if(null==n)try{n=JSON.parse(e.replace(/'/g,'"'))}catch(t){}}return n}e.ngModel=n(e.ngModel),e.ngAttrsDate=a(e.ngAttrsDate),e.ngAttrsMonth=a(e.ngAttrsMonth),e.ngAttrsYear=a(e.ngAttrsYear);var l=n(e.ngDate);if(null!=l&&(e.ngModel=l),"string"!=typeof e.ngOrder?e.ngOrder="dmy":e.ngOrder=e.ngOrder.toLowerCase(),e.minDate=n(e.ngMinDate),null==e.ngMinDate){var r=new Date;e.minDate=new Date(r.getFullYear()-100,r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds())}e.maxDate=n(e.ngMaxDate),null==e.maxDate&&(e.maxDate=new Date),e.ngModel<e.minDate&&(e.ngModel=e.minDate),e.ngModel>e.maxDate&&(e.ngModel=e.maxDate),e.years=[];for(var g=e.minDate.getFullYear();g<=e.maxDate.getFullYear();g++)e.years.push(g);"string"==typeof e.ngYearOrder&&0==e.ngYearOrder.indexOf("des")&&e.years.reverse();var o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(void 0!==e.ngMonths&&null!==e.ngMonths){if("string"==typeof e.ngMonths){var d=e.ngMonths.split(",");12==d.length&&(o=d)}Array.isArray(e.ngMonths)&&12==e.ngMonths.length&&(o=e.ngMonths)}e.updateMonthList=function(){var n=null!=e.ngModel&&e.ngModel.getFullYear()==e.minDate.getFullYear()?e.minDate.getMonth():0,t=null!=e.ngModel&&e.ngModel.getFullYear()==e.maxDate.getFullYear()?e.maxDate.getMonth():11;e.months=[];for(var a=n;t>=a;a++)e.months.push({index:a,name:o[a]})},e.updateDateList=function(){var n=1;null!=e.ngModel&&e.ngModel.getMonth()==e.minDate.getMonth()&&e.ngModel.getFullYear()==e.minDate.getFullYear()&&(n=e.minDate.getDate());var a=null!=e.ngModel?t(e.ngModel.getMonth()+1,e.ngModel.getFullYear()):t(null,null);null!=e.ngModel&&e.ngModel.getMonth()==e.maxDate.getMonth()&&e.ngModel.getFullYear()==e.maxDate.getFullYear()&&(a=e.maxDate.getDate()),e.dates=[];for(var l=n;a>=l;l++)e.dates.push(l)},e.modelUpdated=function(){e.date=null!=e.ngModel?e.ngModel.getDate():null,e.month=null!=e.ngModel?e.ngModel.getMonth():null,e.year=null!=e.ngModel?e.ngModel.getFullYear():null,e.updateMonthList(),e.updateDateList()},e.$watch("ngModel",function(){e.modelUpdated()}),e.onChange=function(n){if(null!=e.date&&null!=e.month&&null!=e.year){var a=t(e.month+1,e.year),l=0,r=0,g=0,o=0;null!=e.ngModel&&(l=e.ngModel.getHours(),r=e.ngModel.getMinutes(),g=e.ngModel.getSeconds(),o=e.ngModel.getMilliseconds()),e.ngModel=new Date(e.year,e.month,e.date>a?a:e.date,l,r,g,o)}e.updateMonthList(),e.updateDateList()},e.getSomething=function(){return"color:red;"}}],link:function(e,n,t){var a=angular.element,l=a(n[0]).children(),r=e.ngOrder.split("");null!=e.ngAttrsDate&&a(l[0]).attr(e.ngAttrsDate),null!=e.ngAttrsMonth&&a(l[1]).attr(e.ngAttrsMonth),null!=e.ngAttrsYear&&a(l[2]).attr(e.ngAttrsYear);for(var g=0;g<r.length;g++)"d"==r[g]&&a(n[0]).append(l[0]),"m"==r[g]&&a(n[0]).append(l[1]),"y"==r[g]&&a(n[0]).append(l[2])},template:function(){var e='<select ng-model="date" ng-change="onChange(\'date\')" ng-options="date for date in dates"></select><select ng-model="month" ng-change="onChange(\'month\')" ng-options="month.index as month.name for month in months"></select><select ng-model="year" ng-change="onChange(\'year\')" ng-options="year for year in years"></select>';return e}}});
