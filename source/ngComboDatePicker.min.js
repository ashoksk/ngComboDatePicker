/*
 * ngComboDatePicker v1.2.4
 * http://github.com/jfmdev/ngComboDatePicker
 * «Copyright 2015 Jose F. Maldonado»
 * License: LGPLv3 (http://www.gnu.org/licenses/lgpl-3.0.html)
 */
angular.module("ngComboDatePicker",[]).directive("ngComboDatePicker",function(){return{restrict:"AEC",scope:{ngModel:"=",ngDate:"@",ngMinDate:"@",ngMaxDate:"@",ngMonths:"@",ngOrder:"@",ngAttrsDate:"@",ngAttrsMonth:"@",ngAttrsYear:"@",ngYearOrder:"@",ngTimezone:"@",ngPlaceholder:"@"},controller:["$scope",function(a){function b(a,b){var d=null;return void 0!==a&&null!==a&&(a instanceof Date?d=a:"number"!=typeof a&&"string"!=typeof a||(d=new Date(isNaN(a)?a:parseInt(a,10)),d=c(d,b))),d}function c(a,b){var c=isNaN(b)?(new Date).getTimezoneOffset():60*parseFloat(b);return new Date(a.getTime()+60*c*1e3)}function d(a,b){var c=31;return null!=a&&(4!=a&&6!=a&&9!=a&&11!=a||(c=30),null!=b&&2==a&&(c=b%4==0&&b%100!=0?29:28)),c}function e(a){var b=null;if(null!=a){try{b=JSON.parse(a)}catch(a){}if(null==b)try{b=JSON.parse(a.replace(/'/g,'"'))}catch(a){}}return b}a.ngModel=b(a.ngModel,a.ngTimezone),a.ngAttrsDate=e(a.ngAttrsDate),a.ngAttrsMonth=e(a.ngAttrsMonth),a.ngAttrsYear=e(a.ngAttrsYear);var f=b(a.ngDate,a.ngTimezone);if(null!=f&&(a.ngModel=f),"string"!=typeof a.ngOrder?a.ngOrder="dmy":a.ngOrder=a.ngOrder.toLowerCase(),a.minDate=b(a.ngMinDate,a.ngTimezone),null==a.ngMinDate){var g=new Date;a.minDate=new Date(g.getFullYear()-100,g.getMonth(),g.getDate(),g.getHours(),g.getMinutes(),g.getSeconds(),g.getMilliseconds())}a.maxDate=b(a.ngMaxDate,a.ngTimezone),null==a.maxDate&&(a.maxDate=new Date),a.ngModel<a.minDate&&(a.ngModel=a.minDate),a.ngModel>a.maxDate&&(a.ngModel=a.maxDate);var h=null;if(void 0!==a.ngPlaceholder&&null!==a.ngPlaceholder&&("string"==typeof a.ngPlaceholder||Array.isArray(a.ngPlaceholder))){var i="string"==typeof a.ngPlaceholder?a.ngPlaceholder.split(","):a.ngPlaceholder;if(3==i.length){h=[];for(var j=0;j<i.length;j++)h.push({value:"",name:i[j],disabled:!1})}}a.years=[];for(var k=a.minDate.getFullYear();k<=a.maxDate.getFullYear();k++)a.years.push({value:k,name:k});"string"==typeof a.ngYearOrder&&0==a.ngYearOrder.indexOf("des")&&a.years.reverse(),h&&a.years.unshift(h[0]);var l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(void 0!==a.ngMonths&&null!==a.ngMonths){if("string"==typeof a.ngMonths){var m=a.ngMonths.split(",");12==m.length&&(l=m)}Array.isArray(a.ngMonths)&&12==a.ngMonths.length&&(l=a.ngMonths)}a.updateMonthList=function(){var b=null!=a.ngModel&&a.ngModel.getFullYear()==a.minDate.getFullYear()?a.minDate.getMonth():0,c=null!=a.ngModel&&a.ngModel.getFullYear()==a.maxDate.getFullYear()?a.maxDate.getMonth():11;a.months=[],h&&a.months.push(h[1]);for(var d=b;d<=c;d++)a.months.push({value:d,name:l[d]})},a.updateDateList=function(){var b=1;null!=a.ngModel&&a.ngModel.getMonth()==a.minDate.getMonth()&&a.ngModel.getFullYear()==a.minDate.getFullYear()&&(b=a.minDate.getDate());var c=null!=a.ngModel?d(a.ngModel.getMonth()+1,a.ngModel.getFullYear()):d(null,null);null!=a.ngModel&&a.ngModel.getMonth()==a.maxDate.getMonth()&&a.ngModel.getFullYear()==a.maxDate.getFullYear()&&(c=a.maxDate.getDate()),a.dates=[],h&&a.dates.push(h[2]);for(var e=b;e<=c;e++)a.dates.push({value:e,name:e})},a.modelUpdated=function(){a.ngModel?(a.date=a.ngModel.getDate(),a.month=a.ngModel.getMonth(),a.year=a.ngModel.getFullYear()):(a.date="",a.month="",a.year="",h&&(h[0].disabled=!1,h[1].disabled=!1,h[2].disabled=!1)),a.updateMonthList(),a.updateDateList()},a.$watch("ngModel",function(){a.modelUpdated()}),a.onChange=function(b){if(null!=a.date&&""!=a.date&&!isNaN(parseInt(a.month))&&null!=a.year&&""!=a.year){var c=d(a.month+1,a.year),e=0,f=0,g=0,i=0;null!=a.ngModel&&(e=a.ngModel.getHours(),f=a.ngModel.getMinutes(),g=a.ngModel.getSeconds(),i=a.ngModel.getMilliseconds()),a.ngModel=new Date(a.year,a.month,a.date>c?c:a.date,e,f,g,i)}h&&(""!=a.year&&(h[0].disabled=!0),""!=a.month&&(h[1].disabled=!0),""!=a.date&&(h[2].disabled=!0)),a.updateMonthList(),a.updateDateList()},a.getSomething=function(){return"color:red;"}}],link:function(a,b,c){var d=angular.element,e=d(b[0]).children(),f=a.ngOrder.split("");null!=a.ngAttrsDate&&d(e[0]).attr(a.ngAttrsDate),null!=a.ngAttrsMonth&&d(e[1]).attr(a.ngAttrsMonth),null!=a.ngAttrsYear&&d(e[2]).attr(a.ngAttrsYear);for(var g=0;g<f.length;g++)"d"==f[g]&&d(b[0]).append(e[0]),"m"==f[g]&&d(b[0]).append(e[1]),"y"==f[g]&&d(b[0]).append(e[2])},template:function(){var a='<select ng-model="date" ng-change="onChange(\'date\')" ng-options="date.value as date.name disable when date.disabled for date in dates"></select><select ng-model="month" ng-change="onChange(\'month\')" ng-options="month.value as month.name disable when month.disabled for month in months"></select><select ng-model="year" ng-change="onChange(\'year\')" ng-options="year.value as year.name disable when year.disabled for year in years"></select>';return a}}});
